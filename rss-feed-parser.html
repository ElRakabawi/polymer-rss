<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">

<polymer-element name="rss-feed-parser" constructor="RSSFeedParser" attributes="auto url headers params" hidden>

  <template>
    <core-ajax id="ajax" url="{{url}}" auto?="{{auto}}" body="{{body}}" headers="{{headers}}" on-core-response="{{handleResponse}}" handleAs="xml">
  </template>

  <script>
    Polymer('rss-feed-parser', {
      auto: false,
      handleResponse: function(event) {
        var response = event.detail.response;
        if(!response.querySelector('rss')) {
          this.fire('invalid-feed', {response: response, xhr: event.detail.xhr});
        }else {
          var channel = response.querySelector('rss channel');
          var feed = this.parseChannel(channel));
          this.fire('feed-parsed', { feed: feed, response: response, xhr: event.detail.xhr} );
        }
      },
      go: function() {
        this.$.ajax.go();
      },
      parseChannel: function(channel) {
        var feed = {};
        feed.title = channel.querySelector('title').textContent;
        feed.description = channel.querySelector('description').textContent;
        feed.link = channel.querySelector('link').textContent;
        return feed;
      }
    });
  </script>
</polymer-element>
