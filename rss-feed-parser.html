<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">

<polymer-element name="rss-feed-parser" constructor="RSSFeedParser" attributes="auto url headers params" hidden>

  <template>
    <core-ajax id="ajax" url="{{url}}" auto?="{{auto}}" body="{{body}}" headers="{{headers}}" on-core-response="{{handleResponse}}" handleAs="xml">
  </template>

  <script>
    Polymer('rss-feed-parser', {
      auto: false,
      handleResponse: function(event) {
        var rss = {}; //TODO: REAL STUFF
        var response = event.detail.response;
        if(!response.querySelector('rss')) {
          this.fire('invalid-feed', {response: response, xhr: event.detail.xhr});
        }else {
          var channel = response.querySelector('rss channel');
          this.fire('feed-parsed', { rss: rss, response: response, xhr: event.detail.xhr} );
        }
      },
      go: function() {
        this.$.ajax.go();
      }
    });
  </script>
</polymer-element>
